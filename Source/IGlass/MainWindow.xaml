<Window xmlns="http://schemas.microsoft.com/netfx/2007/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" 
        xmlns:fsx="clr-namespace:FsXaml;assembly=FsXaml.Wpf"
        xmlns:model="clr-namespace:iGlass.ViewModels;assembly=IGlass"
        Title="{Binding Title, Mode=OneWay}"
        AllowDrop="true" Background="DimGray"
        MinWidth="1 in" MinHeight="1 in">
  <Window.Resources>
    <ResourceDictionary>
      <model:MainWindowViewModel x:Key="model" />
      <model:ScaleModelConverter x:Key="scaleModelConverter"/>
      <model:DragEnterConverter x:Key="dragEnterConverter" />
      <model:DropConverter x:Key="dropConverter" />
    </ResourceDictionary>
  </Window.Resources>
  <Window.DataContext>
    <Binding Source="{StaticResource model}" />
  </Window.DataContext>
  <Window.InputBindings>
    <KeyBinding Command="NextPage" Key="Right" />
    <KeyBinding Command="LastPage" Key="Left" />
  </Window.InputBindings>
  <i:Interaction.Triggers>
    <i:EventTrigger EventName="DragEnter">
      <fsx:EventToCommand Command="model:AppCommands.CheckDrop" EventArgsConverter="{StaticResource dragEnterConverter}" /></i:EventTrigger>
    <i:EventTrigger EventName="Drop"><fsx:EventToCommand Command="model:AppCommands.DropItem" EventArgsConverter="{StaticResource dropConverter}" /></i:EventTrigger>
  </i:Interaction.Triggers>      
  <DockPanel>
    <UniformGrid DockPanel.Dock="Top">
      <Button Command="LastPage">Left</Button>
      <Button Command="NextPage">Right</Button>
    </UniformGrid>
    <ScrollViewer x:Name="imageView"
                  VerticalScrollBarVisibility="{Binding VScrollbarVisibility, Mode=OneWay}"
                  HorizontalScrollBarVisibility="{Binding HScrollbarVisibility, Mode=OneWay}"
                  SizeChanged="NotifyViewportChanged"
                  PanningMode="Both">
      <ScrollViewer.ContextMenu>
        <ContextMenu>
          <MenuItem Header="_Zoom">
            <MenuItem Header="_Scale Up to Window" IsCheckable="True" 
                      IsChecked="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, ConverterParameter=ScaleUpToWindow, Mode=OneWay}"
                      Command="model:AppCommands.ZoomChanged" CommandParameter="ScaleUpToWindow" />
            <MenuItem Header="_Fit to Window" IsCheckable="True" 
                      IsChecked="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, ConverterParameter=FitToWindow, Mode=OneWay}"
                      Command="model:AppCommands.ZoomChanged" CommandParameter="FitToWindow" />
            <MenuItem Header="Fil_l to Window" IsCheckable="True" 
                      IsChecked="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, ConverterParameter=FillWindow, Mode=OneWay}"
                      Command="model:AppCommands.ZoomChanged" CommandParameter="FillWindow" />
            <MenuItem Header="_Manual" IsCheckable="True" 
                      IsChecked="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, ConverterParameter=Manual, Mode=OneWay}"
                      Command="model:AppCommands.ZoomChanged" CommandParameter="Manual" />
          </MenuItem>
        </ContextMenu>
      </ScrollViewer.ContextMenu>
      <Image Source="{Binding ImageSource, Mode=OneWay}"
             Stretch="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, Mode=OneWay}"
             StretchDirection="{Binding ScaleMode, Converter={StaticResource scaleModelConverter}, Mode=OneWay}">
        <Image.LayoutTransform>
          <ScaleTransform ScaleX="{Binding ScaleApply, Mode=OneWay}"
                          ScaleY="{Binding ScaleApply, Mode=OneWay}" />
        </Image.LayoutTransform>
      </Image>
    </ScrollViewer>
  </DockPanel>
</Window>